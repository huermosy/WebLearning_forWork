<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Context é”™è¯¯ä½¿ç”¨ç¤ºä¾‹</title>
  <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      padding: 20px;
      max-width: 800px;
      margin: 0 auto;
    }
    .mall {
      border: 2px solid #333;
      padding: 20px;
      margin-bottom: 20px;
    }
    .floor {
      border: 2px solid #666;
      padding: 15px;
      margin: 10px 0;
    }
    .section {
      border: 2px solid #999;
      padding: 10px;
      margin: 10px 0;
    }
    .store {
      background-color: #f0f0f0;
      padding: 10px;
      margin: 10px 0;
      border-radius: 5px;
    }
    .controls {
      margin-bottom: 20px;
    }
    button {
      padding: 8px 16px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 10px;
    }
    button:hover {
      background-color: #45a049;
    }
    h1, h2, h3 {
      color: #333;
    }
    .info {
      background-color: #ffcccc;
      border-left: 6px solid #f44336;
      padding: 10px;
      margin: 10px 0;
    }
    .error-box {
      background-color: #ffebee;
      border: 1px solid #f44336;
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <h1>Context é”™è¯¯ä½¿ç”¨ç¤ºä¾‹ - ç»„ä»¶åä¸åŒ¹é…</h1>
  <div class="info">
    <p>è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº† Context çš„é”™è¯¯ä½¿ç”¨æ–¹å¼ï¼Œç»„ä»¶åç§°å’Œä½¿ç”¨çš„æ ‡ç­¾åç§°ä¸ä¸€è‡´ã€‚</p>
    <p>è¯·æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯ä¿¡æ¯ï¼šæœè£…åŒºç»„ä»¶æœªå®šä¹‰ï¼Œä½†åœ¨JSXä¸­å°è¯•ä½¿ç”¨ã€‚</p>
  </div>
  
  <div id="root"></div>
  <div id="error-display" class="error-box" style="display:none">
    <h3>é”™è¯¯ä¿¡æ¯ï¼š</h3>
    <p id="error-message">è¯·æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°(F12)æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯</p>
  </div>

  <script type="text/babel">
    // åˆ›å»ºä¸€ä¸ª Context
    const å•†åœºå¹¿æ’­ = React.createContext();

    // é”™è¯¯å¤„ç†å‡½æ•°
    class ErrorBoundary extends React.Component {
      constructor(props) {
        super(props);
        this.state = { hasError: false, error: null };
      }

      static getDerivedStateFromError(error) {
        return { hasError: true, error: error };
      }

      componentDidCatch(error, errorInfo) {
        console.error("ç»„ä»¶é”™è¯¯:", error);
        document.getElementById("error-display").style.display = "block";
        document.getElementById("error-message").textContent = 
          "é”™è¯¯ï¼š" + error.message + " - è¿™æ˜¯å› ä¸ºç»„ä»¶åç§°ä¸åŒ¹é…å¯¼è‡´çš„é”™è¯¯";
      }

      render() {
        if (this.state.hasError) {
          return (
            <div className="error-box">
              <h3>ç»„ä»¶é”™è¯¯</h3>
              <p>JSXæ ‡ç­¾åä¸ç»„ä»¶å‡½æ•°åä¸åŒ¹é…ï¼Œå¯¼è‡´Reactæ— æ³•æ‰¾åˆ°ç»„ä»¶</p>
              <p>é”™è¯¯ä¿¡æ¯: {this.state.error && this.state.error.toString()}</p>
              <p>è¯·æ£€æŸ¥æ§åˆ¶å°è·å–æ›´å¤šä¿¡æ¯</p>
            </div>
          );
        }
        return this.props.children;
      }
    }

    // å•†åœºç»„ä»¶ (é¡¶å±‚ç»„ä»¶)
    function å•†åœº() {
      // ä½¿ç”¨ useState ç®¡ç†ä¿ƒé”€ä¿¡æ¯
      const [ä¿ƒé”€ä¿¡æ¯, setä¿ƒé”€ä¿¡æ¯] = React.useState('å…¨åœº8æŠ˜');
      
      // æ›´æ”¹ä¿ƒé”€ä¿¡æ¯çš„å‡½æ•°
      const æ›´æ–°ä¿ƒé”€ = () => {
        if (ä¿ƒé”€ä¿¡æ¯ === 'å…¨åœº8æŠ˜') {
          setä¿ƒé”€ä¿¡æ¯('é™æ—¶5æŠ˜');
        } else if (ä¿ƒé”€ä¿¡æ¯ === 'é™æ—¶5æŠ˜') {
          setä¿ƒé”€ä¿¡æ¯('ä¹°ä¸€é€ä¸€');
        } else {
          setä¿ƒé”€ä¿¡æ¯('å…¨åœº8æŠ˜');
        }
      };

      return (
        <div className="mall">
          <h2>ğŸ¬ è´­ç‰©ä¸­å¿ƒ</h2>
          <div className="controls">
            <button onClick={æ›´æ–°ä¿ƒé”€}>æ›´æ–°ä¿ƒé”€æ´»åŠ¨</button>
            <span>å½“å‰ä¿ƒé”€: <strong>{ä¿ƒé”€ä¿¡æ¯}</strong></span>
          </div>
          
          {/* ä½¿ç”¨ Provider å°†ä¿ƒé”€ä¿¡æ¯æä¾›ç»™æ‰€æœ‰å­ç»„ä»¶ */}
          <å•†åœºå¹¿æ’­.Provider value={ä¿ƒé”€ä¿¡æ¯}>
            <ErrorBoundary>
              <ä¸€æ¥¼ />
              <äºŒæ¥¼ />
              <ä¸‰æ¥¼ />
            </ErrorBoundary>
          </å•†åœºå¹¿æ’­.Provider>
        </div>
      );
    }

    // ä¸€æ¥¼ç»„ä»¶
    function ä¸€æ¥¼() {
      return (
        <div className="floor">
          <h3>ğŸª ä¸€æ¥¼</h3>
          <è¶…å¸‚ />
        </div>
      );
    }

    // äºŒæ¥¼ç»„ä»¶
    function äºŒæ¥¼() {
      return (
        <div className="floor">
          <h3>ğŸ‘š äºŒæ¥¼</h3>
          <div className="section">
            <h4>æœè£…åŒº</h4>
            {/* é”™è¯¯: è¿™é‡Œä½¿ç”¨äº† æœè£…åŒº æ ‡ç­¾ï¼Œä½†å®šä¹‰çš„æ˜¯ æœè£…åº— ç»„ä»¶ */}
            <æœè£…åŒº />
          </div>
        </div>
      );
    }

    // ä¸‰æ¥¼ç»„ä»¶
    function ä¸‰æ¥¼() {
      return (
        <div className="floor">
          <h3>ğŸ” ä¸‰æ¥¼</h3>
          <div className="section">
            <h4>é¤å…åŒº</h4>
            <é¤å… />
          </div>
        </div>
      );
    }

    // è¶…å¸‚ç»„ä»¶
    function è¶…å¸‚() {
      // ä½¿ç”¨ useContext è·å–ä¿ƒé”€ä¿¡æ¯
      const å½“å‰ä¿ƒé”€ = React.useContext(å•†åœºå¹¿æ’­);
      return (
        <div className="store">
          <h5>ğŸ›’ å¤§å‹è¶…å¸‚</h5>
          <p>è¶…å¸‚å…¬å‘Šï¼šæœ¬è¶…å¸‚å‚ä¸<strong>{å½“å‰ä¿ƒé”€}</strong>æ´»åŠ¨ï¼</p>
        </div>
      );
    }

    // æœè£…åº—ç»„ä»¶ - å®šä¹‰ä¸ºæœè£…åº—ï¼Œä½†ä¸Šé¢ä½¿ç”¨çš„æ˜¯æœè£…åŒºæ ‡ç­¾
    function æœè£…åº—() {
      // ä½¿ç”¨ useContext è·å–ä¿ƒé”€ä¿¡æ¯
      const å½“å‰ä¿ƒé”€ = React.useContext(å•†åœºå¹¿æ’­);
      return (
        <div className="store">
          <h5>ğŸ‘• æ—¶å°šæœè£…åº—</h5>
          <p>æœè£…åº—å…¬å‘Šï¼šå…¨åº—<strong>{å½“å‰ä¿ƒé”€}</strong>ï¼Œå¿«æ¥é€‰è´­ï¼</p>
        </div>
      );
    }

    // é¤å…ç»„ä»¶
    function é¤å…() {
      // ä½¿ç”¨ useContext è·å–ä¿ƒé”€ä¿¡æ¯
      const å½“å‰ä¿ƒé”€ = React.useContext(å•†åœºå¹¿æ’­);
      return (
        <div className="store">
          <h5>ğŸ ç¾é£Ÿé¤å…</h5>
          <p>é¤å…ç‰¹æƒ ï¼šæœ¬å‘¨<strong>{å½“å‰ä¿ƒé”€}</strong>ï¼Œæ¬¢è¿å“å°ï¼</p>
        </div>
      );
    }

    // æ¸²æŸ“åº”ç”¨
    try {
      ReactDOM.render(<å•†åœº />, document.getElementById('root'));
    } catch (error) {
      console.error("æ¸²æŸ“é”™è¯¯:", error);
      document.getElementById("error-display").style.display = "block";
      document.getElementById("error-message").textContent = "æ¸²æŸ“é”™è¯¯ï¼š" + error.message;
    }
  </script>
</body>
</html>
